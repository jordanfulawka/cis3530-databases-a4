{% extends "base.html" %} {% block title %}Projects{% endblock %} {% block
content %}
<h1>Projects</h1>

<button type="button" onclick="exportTableToCSV('projects_export.csv')"> Export Table to CSV </button>

<table border="1" id="projectsTable">
  <thead>
    <tr>
      <th>Project Name</th>
      <th>Owning Department</th>
      <th>Headcount</th>
      <th>Total Assigned Hours</th>
    </tr>
  </thead>
  <tbody>
    {% for project in projects %}
    <tr>
      <td>
        <a
          href="{{ url_for('project_details', project_id=project['project_number']) }}"
        >
          {{ project['project_name'] }}
        </a>
      </td>
      <td>{{ project['department_name'] }}</td>
      <td>{{ project['headcount'] }}</td>
      <td>{{ project['total_hours'] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  function downloadCSV(csv, filename) {
    const csvFile = new Blob([csv], { type: 'text/csv' });
    const downloadLink = document.createElement('a');
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = 'none';
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }

  function exportTableToCSV(filename) {
    const rows = document.querySelectorAll('#projectsTable tr');
    let csv = [];

    for (let i = 0; i < rows.length; i++) {
      let row = [], cols = rows[i].querySelectorAll('td, th');
      for (let j = 0; j < cols.length; j++) {
        row.push(cols[j].innerText);
      }
      csv.push(row.join(','));
    }

    downloadCSV(csv.join('\n'), filename);
  }
</script>

{% endblock %}
